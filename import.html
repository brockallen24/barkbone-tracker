<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import Products - Barkbone Tracker</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background: #5568d3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin-top: 20px;
            white-space: pre-wrap;
        }
        .success { color: #44ff44; }
        .error { color: #ff4444; }
        .warning { color: #ffaa00; }
        .info { color: #44aaff; }
        .progress {
            background: #e0e0e0;
            border-radius: 4px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-bar {
            background: #667eea;
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì¶ Import Products to Airtable</h1>
        <p class="subtitle">This will import 34 products from the JSON file into your Airtable base.</p>

        <button id="importBtn" onclick="importProducts()">Import All Products</button>
        <button onclick="window.location.href='/'">Back to Tracker</button>

        <div class="progress" id="progressContainer" style="display:none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div id="log" class="log" style="display:none;"></div>
    </div>

    <script src="config.js"></script>
    <script>
        const products = [
  {
    "id": 1000004,
    "partNumber": "29235",
    "description": "PLAY ON HEAVY CHEW BACON WISHBONE LG (WBB2)",
    "openPO": "7250",
    "boxSize": "11.1X10.2X8.9",
    "casePack": "24",
    "backerStock": "115",
    "amountNeeded": "3000",
    "priority": "critical"
  },
  {
    "id": 1000019,
    "partNumber": "36044",
    "description": "PQ WISHBONE BARKBONE BACON LG (WBB1)",
    "openPO": "7006",
    "boxSize": "12.0X6.0X6.0",
    "casePack": "3",
    "backerStock": "13726",
    "amountNeeded": "2000",
    "priority": "critical"
  },
  {
    "id": 1000022,
    "partNumber": "36047",
    "description": "PQ WISHBONE BARKBONE PB LG (WPB1)",
    "openPO": "8406",
    "boxSize": "12.0X6.0X6.0",
    "casePack": "3",
    "backerStock": "10747",
    "amountNeeded": "2000",
    "priority": "critical"
  },
  {
    "id": 1000021,
    "partNumber": "36046",
    "description": "PQ WISHBONE BARKBONE BACON SM (WBB3)",
    "openPO": "29628",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "4",
    "backerStock": "10000",
    "amountNeeded": "5000",
    "priority": "critical"
  },
  {
    "id": 1000009,
    "partNumber": "36030",
    "description": "PQ DINO BARKBONE STEAK BEAST (DBB5)",
    "openPO": "3606",
    "boxSize": "12.0X6.0X6.0",
    "casePack": "3",
    "backerStock": "9000",
    "amountNeeded": "2406",
    "priority": "critical"
  },
  {
    "id": 1000012,
    "partNumber": "36036",
    "description": "PQ DINO BARKBONE PB & WOOD MD (DBW3)",
    "openPO": "3006",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "4",
    "backerStock": "1248",
    "amountNeeded": "1248",
    "priority": "critical"
  },
  {
    "id": 1000026,
    "partNumber": "36067",
    "description": "PQ RAWHIDE BACON LG (RBB2)",
    "openPO": "Waiting Approval (1002 pcs pending)",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "3",
    "backerStock": "2674",
    "amountNeeded": "1002",
    "priority": "critical"
  },
  {
    "id": 1000020,
    "partNumber": "36045",
    "description": "PQ WISHBONE BARKBONE BACON MD (WBB2)",
    "openPO": "25280",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "3",
    "backerStock": "10012",
    "amountNeeded": "10012",
    "priority": "high"
  },
  {
    "id": 1000024,
    "partNumber": "36049",
    "description": "PQ WISHBONE BARKBONE PB SM (WPB3)",
    "openPO": "4122",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "4",
    "backerStock": "11166",
    "amountNeeded": "2000",
    "priority": "high"
  },
  {
    "id": 1000032,
    "partNumber": "32530",
    "description": "TJX BB WB BACON & STICK PB MD 2PK",
    "openPO": "31140",
    "boxSize": "15.0X10.0X12.0",
    "casePack": "6",
    "backerStock": "14174",
    "amountNeeded": "10000",
    "priority": "high"
  },
  {
    "id": 1000014,
    "partNumber": "36039",
    "description": "PQ STICK BARKBONE PB MD (BBS2)",
    "openPO": "22006",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "3",
    "backerStock": "4598",
    "amountNeeded": "10000",
    "priority": "high"
  },
  {
    "id": 1000023,
    "partNumber": "36048",
    "description": "PQ WISHBONE BARKBONE PB MD (WPB2)",
    "openPO": "6000",
    "boxSize": "8.0X6.0X4.0",
    "casePack": "3",
    "backerStock": "2042",
    "amountNeeded": "Shipped 2958 on 12/12/25",
    "priority": "high"
  },
  {
    "id": 1000006,
    "partNumber": "36026",
    "description": "PQ DINO BARKBONE BACON BEAST (DBB1)",
    "openPO": "4012",
    "boxSize": "12.0X6.0X6.0",
    "casePack": "3",
    "backerStock": "18196",
    "amountNeeded": "2000",
    "priority": "medium"
  },
  {
    "id": 1000015,
    "partNumber": "36040",
    "description": "PQ STICK BARKBONE PB SM (BBS3)",
    "openPO": "25000",
    "boxSize": "6.0X6.0X4.0",
    "casePack": "4",
    "backerStock": "2485",
    "amountNeeded": "10000",
    "priority": "medium"
  },
  {
    "id": 1000008,
    "partNumber": "36028",
    "description": "PQ DINO BARKBONE BACON MD (DBB3)",
    "openPO": "10000",
    "boxSize": "8.0X6.0X4.5",
    "casePack": "4",
    "backerStock": "12959",
    "amountNeeded": "10000",
    "priority": "medium"
  },
  {
    "id": 1000000,
    "partNumber": "29231",
    "description": "PLAY ON HEAVY CHEW PB STICK XL (BBS1)",
    "casePack": "18",
    "boxSize": "24.0X15.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000001,
    "partNumber": "29232",
    "description": "PLAY ON HEAVY CHEW PB STICK LG (BBS2)",
    "casePack": "24",
    "boxSize": "24.0X15.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000002,
    "partNumber": "29233",
    "description": "PLAY ON HEAVY CHEW PB STICK MD (BBS3)",
    "casePack": "36",
    "boxSize": "24.0X15.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000003,
    "partNumber": "29234",
    "description": "PLAY ON HEAVY CHEW BACON WISHBONE XL (WBB1)",
    "casePack": "18",
    "boxSize": "18.9X6.5X10.8",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000005,
    "partNumber": "29236",
    "description": "PLAY ON HEAVY CHEW BACON WISHBONE MD (WBB3)",
    "casePack": "36",
    "boxSize": "13.0X7.9X7.2",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000007,
    "partNumber": "36027",
    "description": "PQ DINO BARKBONE BACON LG (DBB2)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000010,
    "partNumber": "36034",
    "description": "PQ DINO BARKBONE PB & WOOD BEAST (DBW1)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000011,
    "partNumber": "36035",
    "description": "PQ DINO BARKBONE PB & WOOD LG (DBW2)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000013,
    "partNumber": "36038",
    "description": "PQ STICK BARKBONE PB XL (BBS1)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000016,
    "partNumber": "36041",
    "description": "PQ STICK BARKBONE MINT XL (BBS4)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000017,
    "partNumber": "36042",
    "description": "PQ STICK BARKBONE MINT MD (BBS5)",
    "casePack": "3",
    "boxSize": "8.0X6.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000018,
    "partNumber": "36043",
    "description": "PQ STICK BARKBONE MINT SM (BBS6)",
    "casePack": "4",
    "boxSize": "6.0X6.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000025,
    "partNumber": "36066",
    "description": "PQ RAWHIDE BACON XL (RBB1)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000027,
    "partNumber": "36068",
    "description": "PQ RAWHIDE BACON SM (RBB3)",
    "casePack": "4",
    "boxSize": "6.0X6.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000028,
    "partNumber": "36070",
    "description": "PQ PIG EAR BACON SM (PEB2)",
    "casePack": "4",
    "boxSize": "6.0X6.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000029,
    "partNumber": "36038G",
    "description": "PQ STICK BARKBONE PB XL INT'L (BBS1)",
    "casePack": "3",
    "boxSize": "12.0X6.0X6.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000030,
    "partNumber": "36039G",
    "description": "PQ STICK BARKBONE PB MD INT'L (BBS2)",
    "casePack": "3",
    "boxSize": "8.0X6.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000031,
    "partNumber": "36040G",
    "description": "PQ STICK BARKBONE PB SM INT'L (BBS3)",
    "casePack": "4",
    "boxSize": "6.0X6.0X4.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  },
  {
    "id": 1000033,
    "partNumber": "50143",
    "description": "DG FP DINO CHEW BONE BACON MD",
    "casePack": "24",
    "boxSize": "10.0X10.0X10.0",
    "openPO": "",
    "backerStock": "",
    "amountNeeded": "",
    "priority": "low"
  }
];

        let AIRTABLE_URL;

        async function initConfig() {
            const isProduction = window.location.hostname !== 'localhost' &&
                                window.location.hostname !== '127.0.0.1' &&
                                !window.location.protocol.startsWith('file:');

            if (isProduction) {
                const response = await fetch('/api/config');
                const config = await response.json();
                window.AIRTABLE_CONFIG = config;
            }

            AIRTABLE_URL = `https://api.airtable.com/v0/${AIRTABLE_CONFIG.baseId}/${AIRTABLE_CONFIG.tableId}`;
        }

        function log(message, type = 'info') {
            const logEl = document.getElementById('log');
            logEl.style.display = 'block';
            const className = type;
            const timestamp = new Date().toLocaleTimeString();
            logEl.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        async function importProducts() {
            const btn = document.getElementById('importBtn');
            btn.disabled = true;
            btn.textContent = 'Importing...';

            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('log').innerHTML = '';

            log('üöÄ Starting import process...', 'info');

            await initConfig();

            log(`üì¶ Loaded ${products.length} products from JSON`, 'success');
            log(`üîó Connecting to Airtable: ${AIRTABLE_CONFIG.baseId}`, 'info');

            let successCount = 0;
            let errorCount = 0;
            const batchSize = 10;

            for (let i = 0; i < products.length; i += batchSize) {
                const batch = products.slice(i, i + batchSize);
                const batchNum = Math.floor(i/batchSize) + 1;
                const totalBatches = Math.ceil(products.length/batchSize);

                log(`üì§ Batch ${batchNum}/${totalBatches} - Importing ${batch.length} products...`, 'info');

                const records = batch.map((product, index) => ({
                    fields: {
                        PartNumber: product.partNumber,
                        Description: product.description,
                        OpenPO: product.openPO || '',
                        BoxSize: product.boxSize || '',
                        CasePack: product.casePack ? parseInt(product.casePack) : 0,
                        BackerStock: product.backerStock || '',
                        AmountNeeded: product.amountNeeded || '',
                        Priority: product.priority || 'none',
                        SortOrder: i + index
                    }
                }));

                try {
                    const response = await fetch(AIRTABLE_URL, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${AIRTABLE_CONFIG.apiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ records })
                    });

                    if (!response.ok) {
                        const errorText = await response.text();
                        log(`   ‚ùå Error: ${response.status} - ${errorText.substring(0, 100)}`, 'error');
                        errorCount += batch.length;
                    } else {
                        const result = await response.json();
                        successCount += result.records.length;
                        log(`   ‚úÖ Successfully imported ${result.records.length} products`, 'success');
                    }
                } catch (error) {
                    log(`   ‚ùå Error: ${error.message}`, 'error');
                    errorCount += batch.length;
                }

                // Update progress
                const progress = ((i + batch.length) / products.length) * 100;
                document.getElementById('progressBar').style.width = progress + '%';

                // Wait between batches
                if (i + batchSize < products.length) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }

            log('', 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log(`üìä Import Complete!`, 'success');
            log(`   ‚úÖ Success: ${successCount} products`, 'success');
            log(`   ‚ùå Errors: ${errorCount} products`, errorCount > 0 ? 'error' : 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');

            if (successCount > 0) {
                log('', 'info');
                log('üéâ Data successfully imported!', 'success');
                log('üîÑ Redirecting to tracker in 3 seconds...', 'info');

                setTimeout(() => {
                    window.location.href = '/';
                }, 3000);
            } else {
                btn.disabled = false;
                btn.textContent = 'Retry Import';
            }
        }
    </script>
</body>
</html>
